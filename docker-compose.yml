web:
  build: .
  volumes:
    - .:/myapp
  links:
    - db
    - redis
  ports:
    - "3000:3000"
  environment:
    - "RAILS_ENV=production"
    - "SECRET_KEY_BASE=b4dcdb0cf93ac1871417d1f8ea8eb39a6156f4bb1fab5e81600c08eb798d3e369ef4df3d973e79beaaad1fce5fad8e9d001970226119409b776b87fe8fd40c13"
  command: bundle exec rails server -b 0.0.0.0
worker:
  build: .
  volumes:
    - .:/myapp
  links:
    - db
    - redis
  environment:
    - "RAILS_ENV=production"
    - "SECRET_KEY_BASE=b4dcdb0cf93ac1871417d1f8ea8eb39a6156f4bb1fab5e81600c08eb798d3e369ef4df3d973e79beaaad1fce5fad8e9d001970226119409b776b87fe8fd40c13"
  command: bundle exec sidekiq
db:
  image: postgres
redis:
  image: redis
cache:
  image: koudaiii/varnish-sample
  environment:
    - "VARNISH_BACKEND_PORT=3000"
    - "VARNISH_PORT=8080"
    - "VARNISH_BACKEND_IP=web"
  ports:
    - "8080:80"
  links:
    - web
